{% extends 'index.html' %}

{% block content %}
<div class="container bg-white p-8 rounded-lg shadow-xl w-full max-w-3xl">
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Min/Max Calculator</h1>
    
    <form id="uploadForm" enctype="multipart/form-data" class="flex flex-col items-center space-y-4">
        <label for="fileInput" class="block text-lg font-medium text-gray-700">
            Upload your Excel file (.xlsx/.xlsm):
        </label>
        <input 
            type="file" 
            name="file" 
            id="fileInput" 
            accept=".xlsx,.xlsm"
            required 
            class="block w-full text-sm text-gray-500
                   file:mr-4 file:py-2 file:px-4
                   file:rounded-full file:border-0
                   file:text-sm file:font-semibold
                   file:bg-green-50 file:text-green-700
                   hover:file:bg-green-100 cursor-pointer
                   rounded-md border border-gray-300 p-2"
        >
        <button 
            type="submit" 
            class="w-full md:w-auto px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-md 
                   hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-75
                   transition duration-200 ease-in-out transform hover:scale-105"
        >
            Calculate Min/Max
        </button>
    </form>

    <div id="results" class="mt-8 border-t-2 border-gray-200 pt-6">
        <!-- Results will be displayed here dynamically -->
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    $('#uploadForm').submit(function(event) {
        event.preventDefault();

        var formData = new FormData(this);
        $('#results').empty();

        $.ajax({
            url: "{{ url_for('min_max.calculate_min_max') }}",
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            headers: { 'X-Requested-With': 'XMLHttpRequest' },
            success: function(response) {
                if (response.success) {
                    var resultsDiv = $('#results');
                    resultsDiv.append('<h2 class="text-2xl font-semibold text-gray-800 mb-4">Weekly Min/Max TotalWeight</h2>');
                    for (var product in response.results) {
                        var minVal = response.results[product].min;
                        var maxVal = response.results[product].max;
                        resultsDiv.append(
                            '<div class="product-item bg-green-50 p-4 rounded-md shadow-sm mb-3 border border-green-200">' +
                                '<h4 class="text-lg font-semibold text-green-800 mb-1">' + product + '</h4>' +
                                '<p class="text-gray-700">Min Weekly TotalWeight: <span class="font-bold text-green-700">' + minVal + '</span></p>' +
                                '<p class="text-gray-700">Max Weekly TotalWeight: <span class="font-bold text-green-700">' + maxVal + '</span></p>' +
                            '</div>'
                        );
                    }
                } else {
                    $('#results').html('<p class="text-red-600 text-center text-lg">Error: ' + response.error + '</p>');
                }
            },
            error: function(xhr) {
                var errorMsg = "An unexpected error occurred. Please check the file format or server logs.";
                if (xhr.responseJSON && xhr.responseJSON.error) {
                    errorMsg = xhr.responseJSON.error;
                }
                $('#results').html('<p class="text-red-600 text-center text-lg">Error: ' + errorMsg + '</p>');
            }
        });
    });
});
</script>
{% endblock %}