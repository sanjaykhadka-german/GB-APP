<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Master</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <header>
        <h1>Recipe</h1>
        <nav>
            <ul>
                <li><a href="{{ url_for('index') }}">Home</a></li>
                <li><a href="{{ url_for('item_master') }}">Item</a></li>
                <li><a href="{{ url_for('recipe_master') }}">Recipe</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <h2>Add New Recipe</h2>
        <form id="recipeForm" action="{{ url_for('add_recipe') }}" method="POST">
            <div id="recipeInputs">
                <div class="recipe-item">
                    <div>
                        <label for="recipeID-1">Recipe ID</label>
                        <input type="text" id="recipeID-1" name="recipeID-1" required>
                    </div>

                    <div>
                        <label for="recipeName-1">Recipe Name</label>
                        <input type="text" id="recipeName-1" name="recipeName-1" required>
                    </div>

                    <div>
                        <label for="itemID-1">Item ID</label>
                        <input type="text" id="itemID-1" name="itemID-1" required>
                    </div>
                    
                    <div>
                        <label for="rawMaterial-1">Raw Material</label>
                        <input type="text" id="rawMaterial-1" name="rawMaterial-1" required>
                    </div>

                    <div>
                        <label for="usageMaterial-1">Usage Material</label>
                        <input type="number" step="0.01" id="usageMaterial-1" name="usageMaterial-1" required>
                    </div>

                    <div>
                        <label for="uom-1">UOM</label>
                        <select id="uom-1" name="uom-1" required>
                            <option value="Box">Box</option>
                            <option value="Bucket">Bucket</option>
                            <option value="Caddy">Caddy</option>
                            <option value="KG">KG</option>
                            <option value="Rolls">Rolls</option>
                            <option value="Unit">Unit</option>
                        </select>
                    </div>
                    <button type="button" class="remove-ingredient" onclick="removeRecipeItem(this)">Remove</button>
                </div>
            </div>
            <div class="button-group">
                <button type="button" onclick="addRecipeItem()">Add Ingredient</button>
                <button type="submit">Add Recipe</button>
            </div>
        </form>
        
        <h2>Recipe List</h2>
        <table>
            <thead>
                <tr>
                    <th>Recipe ID</th>
                    <th>Recipe Name</th>
                    <th>Item ID</th>
                    <th>Raw Material</th>
                    <th>Usage Material</th>
                    <th>UOM</th>
                    <th>Percentage</th>
                </tr>
            </thead>
            <tbody>
                {% for recipe in recipes %}
                <tr>
                    <td>{{ recipe.recipeID }}</td>
                    <td>{{ recipe.recipeName }}</td>
                    <td>{{ recipe.itemID }}</td>
                    <td>{{ recipe.rawMaterial }}</td>
                    <td>{{ recipe.usageMaterial }}</td>
                    <td>{{ recipe.uom }}</td>
                    <td>{{ '{:.2f}'.format(percentages.get(recipe.recipeID, 0)) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <script>
            let recipeItemCount = 1;

            function addRecipeItem() {
                recipeItemCount++;
                const recipeInputs = document.getElementById('recipeInputs');
                const newRecipeItem = document.createElement('div');
                newRecipeItem.classList.add('recipe-item');
                newRecipeItem.innerHTML = `
                    <div>
                        <label for="recipeID-${recipeItemCount}">Recipe ID</label>
                        <input type="text" id="recipeID-${recipeItemCount}" name="recipeID-${recipeItemCount}" required>
                    </div>

                    <div>
                        <label for="recipeName-${recipeItemCount}">Recipe Name</label>
                        <input type="text" id="recipeName-${recipeItemCount}" name="recipeName-${recipeItemCount}" required>
                    </div>

                    <div>
                        <label for="itemID-${recipeItemCount}">Item ID</label>
                        <input type="text" id="itemID-${recipeItemCount}" name="itemID-${recipeItemCount}" required>
                    </div>

                    <div>
                        <label for="rawMaterial-${recipeItemCount}">Raw Material</label>
                        <input type="text" id="rawMaterial-${recipeItemCount}" name="rawMaterial-${recipeItemCount}" required>
                    </div>

                    <div>
                        <label for="usageMaterial-${recipeItemCount}">Usage Material</label>
                        <input type="number" step="0.01" id="usageMaterial-${recipeItemCount}" name="usageMaterial-${recipeItemCount}" required>
                    </div>
                        
                    <div>
                        <label for="uom-${recipeItemCount}">UOM</label>
                        <select id="uom-${recipeItemCount}" name="uom-${recipeItemCount}" required>
                            <option value="Box">Box</option>
                            <option value="Bucket">Bucket</option>
                            <option value="Caddy">Caddy</option>
                            <option value="KG">KG</option>
                            <option value="Rolls">Rolls</option>
                            <option value="Unit">Unit</option>
                        </select>
                    </div>
                    <button type="button" class="remove-ingredient" onclick="removeRecipeItem(this)">Remove</button>
                `;
                recipeInputs.appendChild(newRecipeItem);
            }

            function removeRecipeItem(button) {
                const recipeItem = button.closest('.recipe-item');
                const recipeInputs = document.getElementById('recipeInputs');
                
                // Only remove if there's more than one recipe item
                if (recipeInputs.children.length > 1) {
                    recipeItem.remove();
                } else {
                    alert('Cannot remove the last ingredient entry.');
                }
            }
        </script>
  </main>
</body>
</html>